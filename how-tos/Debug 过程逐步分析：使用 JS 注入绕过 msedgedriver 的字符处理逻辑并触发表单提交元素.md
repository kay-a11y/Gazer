> **å…è´£å£°æ˜ï¼š** åœ¨ä½¿ç”¨æ­¤æŒ‡å—ä¹‹å‰ï¼Œè¯·åŠ¡å¿…ä»”ç»†é˜…è¯»å¹¶ç†è§£ [DISCLAIMER.md](DISCLAIMER.md) æ–‡ä»¶ä¸­çš„å…è´£å£°æ˜ã€‚

---

# Debug è¿‡ç¨‹é€æ­¥åˆ†æï¼šä½¿ç”¨ JS æ³¨å…¥ç»•è¿‡ msedgedriver çš„å­—ç¬¦å¤„ç†é€»è¾‘å¹¶è§¦å‘è¡¨å•æäº¤å…ƒç´ 

æœ¬æ–‡è®°å½•äº†ä¸€æ¬¡ä½¿ç”¨ Python å’Œ Selenium ç¼–å†™å¾®åšè‡ªåŠ¨å‘å¸ƒè„šæœ¬æ—¶é‡åˆ°çš„ Debug è¿‡ç¨‹ã€‚é€šè¿‡è¿™æ¬¡ Debugï¼Œæˆ‘æ·±å…¥äº†è§£äº† msedgedriver å¯¹ Unicode å­—ç¬¦çš„æ”¯æŒã€JavaScript äº‹ä»¶è§¦å‘æœºåˆ¶ä»¥åŠ Selenium çš„å·¥ä½œåŸç†ã€‚

## é”™è¯¯ä»£ç ç¤ºä¾‹

è¿™é‡Œå±•ç¤ºå‘é€å¾®åšçš„æ ¸å¿ƒä»£ç å—`ghost_writer`å‡½æ•°, ä¸»è¦å’Œè¡¨å•æäº¤ä»¥åŠéšå¼ç­‰å¾…æœ‰å…³:

```python
def ghost_writer(driver, writer, onlyme=2, uppics=None):
    """å¡«å†™å¾®åšæ–‡æœ¬, (å¯é€‰)æ˜¯å¦è‡ªå·±å¯è§, (å¯é€‰)ä¸Šä¼ å›¾ç‰‡æˆåŠŸåè‡ªåŠ¨åˆ é™¤å›¾ç‰‡, è‡ªåŠ¨å‘é€å¾®åš

    Args:
        driver (_type_): _description_
        writer (string): å¡«å†™å¾®åšæ–‡æœ¬
        onlyme (int, optional): 0:æ‰€æœ‰äºº, 1:å¥½å‹åœˆ, 2:ä»…è‡ªå·±. Defaults to 1.
        uppics (list, optional): å›¾ç‰‡è·¯å¾„åˆ—è¡¨. Defaults to None.
    """

    wait = WebDriverWait(driver, 10)

    # ç­‰å¾…æ–‡æœ¬æ¡†å¯è§
    weibo_textarea = wait.until(EC.visibility_of_element_located((By.CSS_SELECTOR, 'div > span > textarea')))
    # driver.execute_script("arguments[0].scrollIntoView();", weibo_textarea)
    # è¾“å…¥æƒ³å‘å¸ƒçš„å¾®åšå†…å®¹
    weibo_textarea.send_keys(writer)

    # ä¸Šä¼ å›¾ç‰‡
    if uppics:
        # ç­‰å¾…ä¸Šä¼ æŒ‰é’®å¯è§
        file_input = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, 'input[type="file"]')))
        for path in uppics:
            file_input.send_keys(path)
        # ç­‰å¾…ä¸Šä¼ å®Œæˆçš„é€»è¾‘, è¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥å†™
        time.sleep(3)  # å‡è®¾ä¸Šä¼ éœ€è¦3ç§’é’Ÿ, å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´

    # é€‰æ‹©å¯è§æ€§
    # ç­‰å¾…å¯è§æ€§æŒ‰é’®å¯è§
    visible_button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, 'div.visible')))

    visible_options = 3 # 0:æ‰€æœ‰äºº, 1:å¥½å‹åœˆ, 2:ä»…è‡ªå·±
    if 0 <= onlyme < visible_options:
        for i in range(onlyme):
            visible_button.click()
            # time.sleep(0.3)
    else:
        print(f"å¯è§æ€§å‚æ•°é”™è¯¯: onlyme={onlyme}, åº”è¯¥åœ¨ 0, 1, 2 ä¸­é€‰æ‹©.")
  
    # æäº¤å¾®åš
    # ç­‰å¾…æäº¤æŒ‰é’®å¯è§
    submit_button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, 'div.m-box.m-flex-grow1.m-box-model.m-fd-row.m-aln-center.m-justify-end.m-flex-base0 > a')))
    submit_button.click()
    time.sleep(2)
    print("å¾®åšå‘å¸ƒæˆåŠŸ")
```

## é…ç½®ç¯å¢ƒ

- Python 3
- Selenium
- msedgedriver (Microsoft Edge WebDriver)
- å¾®åš: https://m.weibo.cn/compose/

## é—®é¢˜ä¸€ï¼š`selenium.common.exceptions.WebDriverException: Message: unknown error: msedgedriver only supports characters in the BMP`

### é—®é¢˜å‘ç°

åœ¨ä½¿ç”¨å¾®åšå‘å¸ƒè„šæœ¬å‘é€ä¸€æ®µåŒ…å« emojiï¼ˆä¾‹å¦‚ğŸ˜­ï¼‰çš„æ–‡æœ¬æ—¶ï¼Œè„šæœ¬æŠ¥é”™ï¼š

```
selenium.common.exceptions.WebDriverException: Message: unknown error: msedgedriver only supports characters in the BMP
```

### é—®é¢˜æ’æŸ¥

1. **æ£€æŸ¥ä»£ç ï¼š** é¦–å…ˆæ£€æŸ¥äº† `ghost_writer` å‡½æ•°ä¸­å¯èƒ½å¯¼è‡´é—®é¢˜çš„ä»£ç è¡Œ, ä¾‹å¦‚CSSé€‰æ‹©å™¨å®šä½å…ƒç´ éƒ¨åˆ†, æ²¡æœ‰å‘ç°é—®é¢˜.
2. **éªŒè¯ Cookieï¼š**  é‡æ–°å¤åˆ¶äº†å¾®åšçš„ Cookie å¹¶æ›´æ–°åˆ°è„šæœ¬ä¸­ï¼Œç„¶åé‡æ–°è¿è¡Œï¼Œé—®é¢˜ä¾æ—§ï¼Œæ’é™¤ Cookie å¤±æ•ˆçš„å¯èƒ½æ€§ã€‚

### é—®é¢˜åˆ†æ

é”™è¯¯ä¿¡æ¯ `msedgedriver only supports characters in the BMP` è¡¨æ˜ msedgedriver åªæ”¯æŒ **BMP**ï¼ˆBasic Multilingual Planeï¼ŒåŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼‰ä¸­çš„å­—ç¬¦ã€‚

> **ä»€ä¹ˆæ˜¯ BMPï¼Ÿ**
> BMP æ˜¯ Unicode ç¼–ç ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼ŒåŒ…å«äº† U+0000 åˆ° U+FFFF èŒƒå›´å†…çš„å­—ç¬¦ï¼Œæ¶µç›–äº†å¤§å¤šæ•°ç°ä»£è¯­è¨€çš„å­—ç¬¦ï¼ŒåŒ…æ‹¬å¸¸ç”¨çš„æ‹‰ä¸å­—æ¯ã€ä¸­æ–‡å­—ç¬¦ã€æ ‡ç‚¹ç¬¦å·ç­‰ã€‚

è€Œæˆ‘ä»¬ä½¿ç”¨çš„ emoji ğŸ˜­ å¹¶ä¸åœ¨ BMP èŒƒå›´å†…ã€‚ğŸ˜­ çš„ Unicode ç¼–ç ä¸º U+1F62Dï¼Œå®ƒå±äº **SMP**ï¼ˆSupplementary Multilingual Planeï¼Œå¤šæ–‡ç§è¡¥å……å¹³é¢ï¼‰ã€‚

> **å¦‚ä½•æŸ¥è¯¢ BMP èŒƒå›´å†…çš„å­—ç¬¦ï¼Ÿ**  å¯ä»¥åœ¨ Unicode å®˜ç½‘ï¼ˆ[https://unicode.org/charts/](https://unicode.org/charts/)ï¼‰ä¸ŠæŸ¥çœ‹ BMP èŒƒå›´å†…çš„å­—ç¬¦ã€‚BMP çš„èŒƒå›´æ˜¯ U+0000 åˆ° U+FFFFã€‚

**msedgedriver çš„è¿™ä¸ªé™åˆ¶å¯¼è‡´å®ƒæ— æ³•æ­£ç¡®å¤„ç†æˆ‘ä»¬è¾“å…¥çš„ emoji å­—ç¬¦ã€‚**

### è§£å†³æ–¹æ¡ˆæ¢ç´¢

é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°è¯•äº†ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆ 1ï¼šåˆ é™¤æˆ–æ›¿æ¢ç‰¹æ®Šå­—ç¬¦

è¿™æ˜¯æœ€ç®€å•ç›´æ¥çš„æ–¹æ³•ã€‚å°†æ–‡æœ¬ä¸­çš„ emoji ç­‰ç‰¹æ®Šå­—ç¬¦åˆ é™¤ï¼Œæˆ–è€…æ›¿æ¢æˆ BMP èŒƒå›´å†…çš„å­—ç¬¦ï¼Œä¾‹å¦‚ç”¨ `:)` æˆ– `:(` ä»£æ›¿ `ğŸ˜­`ã€‚

- **ä¼˜ç‚¹ï¼š** ç®€å•æ˜“è¡Œï¼Œæ— éœ€ä¿®æ”¹ä»£ç é€»è¾‘ã€‚
- **ç¼ºç‚¹ï¼š**  æ— æ³•ä½¿ç”¨ emoji ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œé™ä½äº†è¡¨è¾¾çš„ä¸°å¯Œåº¦ã€‚

#### æ–¹æ¡ˆ 2ï¼šæ›´æ¢æµè§ˆå™¨é©±åŠ¨

å¦‚æœå¿…é¡»ä½¿ç”¨ emoji ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¯ä»¥è€ƒè™‘æ›´æ¢æˆå¯¹ Unicode å­—ç¬¦æ”¯æŒæ›´å¥½çš„æµè§ˆå™¨é©±åŠ¨ï¼Œä¾‹å¦‚ ChromeDriverã€‚

- **ä¼˜ç‚¹ï¼š**  å¯ä»¥ä»æ ¹æœ¬ä¸Šè§£å†³ msedgedriver å¯¹ Unicode å­—ç¬¦æ”¯æŒä¸ä½³çš„é—®é¢˜ã€‚
- **ç¼ºç‚¹ï¼š**  éœ€è¦ä¸‹è½½å¹¶é…ç½®æ–°çš„æµè§ˆå™¨é©±åŠ¨ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹éƒ¨åˆ†ä»£ç ã€‚

#### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ JavaScript æ³¨å…¥

é€šè¿‡æ‰§è¡Œ JavaScript ä»£ç æ¥è®¾ç½®æ–‡æœ¬æ¡†çš„å€¼ï¼Œç»•è¿‡ Selenium çš„ `send_keys` æ–¹æ³•å’Œ msedgedriver çš„å­—ç¬¦å¤„ç†é€»è¾‘ã€‚

```python
driver.execute_script("arguments[0].value = arguments[1];", weibo_textarea, writer)
```

> **ä»€ä¹ˆæ˜¯ DOM å…ƒç´ ï¼Ÿ**
> DOMï¼ˆDocument Object Modelï¼Œæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰æ˜¯ HTML æ–‡æ¡£çš„ç¼–ç¨‹æ¥å£ã€‚å®ƒå°† HTML æ–‡æ¡£è¡¨ç¤ºä¸ºä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨æ–‡æ¡£çš„ä¸€éƒ¨åˆ†ï¼ˆä¾‹å¦‚ä¸€ä¸ªå…ƒç´ ã€å±æ€§æˆ–æ–‡æœ¬ï¼‰ã€‚JavaScript å¯ä»¥é€šè¿‡ DOM æ¥è®¿é—®å’Œæ“ä½œ HTML æ–‡æ¡£çš„å†…å®¹ã€ç»“æ„å’Œæ ·å¼ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`weibo_textarea` å°±æ˜¯ä¸€ä¸ª DOM å…ƒç´ ï¼Œä»£è¡¨å¾®åšå‘å¸ƒæ¡†ã€‚

- **ä¼˜ç‚¹ï¼š**  æ— éœ€æ›´æ¢æµè§ˆå™¨é©±åŠ¨ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ msedgedriverã€‚
- **ç¼ºç‚¹ï¼š**  è¿™æ˜¯ä¸€ç§æ¯”è¾ƒ hacky çš„æ–¹æ³•ï¼Œå¯èƒ½ä¼šå—åˆ°å¾®åšç½‘ç«™å®‰å…¨ç­–ç•¥çš„å½±å“ã€‚æˆ‘ä»¬ä¼šåœ¨åæ–‡ä¸­è¯¦ç»†è®¨è®ºå®ƒçš„å¼Šç«¯.

#### æ–¹æ¡ˆ 4: ç¼“æ…¢è¾“å…¥

è¿™æ˜¯ä¸€ç§åŸºäºç»éªŒçŒœæµ‹çš„æ–¹æ³•ã€‚è®¤ä¸º `msedgedriver` å¤„ç†é€Ÿåº¦è¾ƒæ…¢, æ— æ³•åŠæ—¶å¤„ç†æ‰€æœ‰è¾“å…¥å­—ç¬¦, ç‰¹åˆ«æ˜¯éBMPå­—ç¬¦, å¦‚emoji. å› æ­¤, å¯ä»¥å°è¯•æ”¾æ…¢è¾“å…¥é€Ÿåº¦, ç»™é©±åŠ¨æ›´å¤šæ—¶é—´å¤„ç†æ¯ä¸ªå­—ç¬¦.

```python
import time

# ... å…¶ä»–ä»£ç  ...

# ç¼“æ…¢è¾“å…¥
for char in writer:
    weibo_textarea.send_keys(char)
    time.sleep(0.1)  # æ¯ä¸ªå­—ç¬¦ä¹‹é—´æš‚åœ 0.1 ç§’

# ... å…¶ä»–ä»£ç  ...

```

- **ä¼˜ç‚¹:** ç®€å•, å®¹æ˜“å®ç°.
- **ç¼ºç‚¹:**
    -   æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œåªæ˜¯è¯•å›¾é€šè¿‡ä¸€ç§å–å·§çš„æ–¹å¼æ¥ç»•è¿‡é—®é¢˜ã€‚
    -   `time.sleep()` çš„æ—¶é—´ä¸å¥½æ§åˆ¶ï¼Œè®¾ç½®å¾—å¤ªçŸ­å¯èƒ½æ— æ•ˆï¼Œè®¾ç½®å¾—å¤ªé•¿ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚
    -   ä¸åŒçš„ç½‘ç»œç¯å¢ƒå’Œç”µè„‘æ€§èƒ½å¯èƒ½ä¼šå¯¼è‡´ `time.sleep()` çš„æ•ˆæœä¸ä¸€è‡´ï¼Œä»è€Œå½±å“ä»£ç çš„ç¨³å®šæ€§ã€‚
    -   å¦‚æœå¾®åšæ›´æ–°äº†å‰ç«¯é€»è¾‘ï¼Œä¸å†å—è¾“å…¥é€Ÿåº¦çš„å½±å“ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šå¤±æ•ˆã€‚

#### æ–¹æ¡ˆ 5: å°†emojiæ›¿æ¢æˆunicodeå‘é€

è¿™ä¹Ÿæ˜¯ä¸€ç§åŸºäºç»éªŒçŒœæµ‹çš„æ–¹æ³•, å¯„å¸Œæœ›äºé©±åŠ¨èƒ½ç›´æ¥æ­£ç¡®å¤„ç†unicode.

```python
writer = """
   çŒœçŒœå“ªä¸ª emoji çš„ unicode æ˜¯ \U0001F62D
   """
```

- **ä¼˜ç‚¹:** ç®€å•, å®¹æ˜“å®ç°.
- **ç¼ºç‚¹:**
    - å¦‚æœé©±åŠ¨æœ¬èº«å°±ä¸æ”¯æŒè¿™ç§æ–¹å¼, é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±ä¼šå¤±æ•ˆ.
    - å¦‚æœå¾®åšæ›´æ–°äº†å‰ç«¯é€»è¾‘, å¯èƒ½å¯¼è‡´è¿™ä¸ªæ–¹æ³•å¤±æ•ˆ.

æœ€ç»ˆï¼Œæˆ‘é€‰æ‹©äº†**æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ JavaScript æ³¨å…¥**ã€‚å› ä¸ºå®ƒåœ¨ä¸æ›´æ¢æµè§ˆå™¨é©±åŠ¨çš„æƒ…å†µä¸‹ï¼Œæœ‰è¾ƒé«˜çš„æˆåŠŸç‡ã€‚

## é—®é¢˜äºŒï¼šJS æ³¨å…¥å†…å®¹åï¼Œæäº¤æŒ‰é’®æœªè¢«æ¿€æ´»

### é—®é¢˜æ’æŸ¥

é€‰æ‹©äº†**æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ JavaScript æ³¨å…¥**å, å‘ç°å®ƒå¯ä»¥æˆåŠŸåœ°ç»•è¿‡msedriverçš„é™åˆ¶, ä½†æ˜¯åœ¨æœ‰å¤´æ¨¡å¼ä¸‹æµ‹è¯•çš„æ—¶å€™, å‘ç°åˆæœ‰æ–°é—®é¢˜å‡ºç°: æ–‡æœ¬è¾“å…¥åï¼Œå³ä¸Šè§’çš„å‘é€æŒ‰é’®ä»ç„¶æ˜¯ç°è‰²çš„ï¼Œæ— æ³•ç‚¹å‡»ã€‚

-   **è§†è§‰ç¡®è®¤:** å½“æ‰‹åŠ¨è¾“å…¥ä»»æ„å­—ç¬¦æ—¶ï¼Œå‘é€æŒ‰é’®ä¼šç«‹å³å˜ä¸ºå¯ç‚¹å‡»çŠ¶æ€ã€‚
-   **å…ƒç´ å®šä½æ’é™¤:** åˆæ­¥æ€€ç–‘æ˜¯å¦æ˜¯ç”±äº DOM ç»“æ„å˜åŒ–, å¯¼è‡´æäº¤æŒ‰é’®å®šä½å¤±æ•ˆ, åæ¥æ’é™¤äº†è¿™ä¸ªçŒœæƒ³. å› ä¸ºåœ¨æœ‰å¤´æ¨¡å¼ä¸‹ï¼Œå¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œå‘é€æŒ‰é’®æ˜¯å¯ä»¥è¢«å®šä½åˆ°çš„, åªä¸è¿‡æ˜¯ç°è‰²ä¸å¯ç‚¹å‡»çŠ¶æ€ã€‚è¿™è¯´æ˜ï¼Œå‘é€æŒ‰é’®çš„å®šä½æ²¡æœ‰é—®é¢˜ï¼Œé—®é¢˜å‡ºåœ¨**æŒ‰é’®æ²¡æœ‰è¢«æ¿€æ´»**ã€‚

### é—®é¢˜åˆ†æ

é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼š**å¾®åšçš„é¡µé¢é€»è¾‘ä¾èµ–äºæŸäº› JavaScript äº‹ä»¶æ¥æ¿€æ´»å‘é€æŒ‰é’®ã€‚**

-   **æ‰‹åŠ¨è¾“å…¥**æ—¶ï¼Œä¼šè§¦å‘ä¸€ç³»åˆ—çš„ JavaScript äº‹ä»¶ï¼Œä¾‹å¦‚ `input`ã€`keyup`ã€`change` ç­‰ã€‚è¿™äº›äº‹ä»¶ä¼šè¢«å¾®åšçš„å‰ç«¯ä»£ç æ•è·ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„é€»è¾‘ï¼Œæœ€ç»ˆæ¿€æ´»å‘é€æŒ‰é’®ã€‚
-   **JS æ³¨å…¥**å†…å®¹æ—¶ï¼Œå¹¶**æ²¡æœ‰è§¦å‘**è¿™äº›å…³é”®çš„ JavaScript äº‹ä»¶ï¼Œå¯¼è‡´å¾®åšçš„å‰ç«¯ä»£ç æ²¡æœ‰æ‰§è¡Œæ¿€æ´»å‘é€æŒ‰é’®çš„é€»è¾‘ã€‚

### è§£å†³æ–¹æ¡ˆ

æ—¢ç„¶é—®é¢˜å‡ºåœ¨ JS äº‹ä»¶æ²¡æœ‰è¢«è§¦å‘ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼š**åœ¨ä½¿ç”¨ JS æ³¨å…¥åï¼Œæ‰‹åŠ¨è§¦å‘è¿™äº›äº‹ä»¶ï¼**

#### æ–¹æ¡ˆ 1ï¼šè§¦å‘ `input` äº‹ä»¶

```javascript
// ä½¿ç”¨ JavaScript è®¾ç½®æ–‡æœ¬æ¡†çš„å€¼
driver.execute_script("arguments[0].value = arguments[1];", weibo_textarea, writer)

// è§¦å‘ input äº‹ä»¶
driver.execute_script("arguments[0].dispatchEvent(new Event('input', { bubbles: true }));", weibo_textarea)
```

- **åŸç†ï¼š**
    -   `dispatchEvent` æ–¹æ³•ç”¨äºåœ¨æŒ‡å®šå…ƒç´ ä¸Šè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚
    -   `new Event('input', { bubbles: true })` åˆ›å»ºäº†ä¸€ä¸ª `input` äº‹ä»¶ï¼Œå¹¶è®¾ç½® `bubbles: true` è¡¨ç¤ºè¯¥äº‹ä»¶ä¼šå‘ä¸Šå†’æ³¡ã€‚

å°† `ghost_writer` å‡½æ•°ä¸­åŸæ¥çš„ `weibo_textarea.send_keys(writer)` æ›¿æ¢æˆä¸Šé¢çš„ä»£ç ã€‚

#### æ–¹æ¡ˆ 2ï¼šè§¦å‘ `change` äº‹ä»¶

```javascript
// ä½¿ç”¨ JavaScript è®¾ç½®æ–‡æœ¬æ¡†çš„å€¼
driver.execute_script("arguments[0].value = arguments[1];", weibo_textarea, writer)

// è§¦å‘ change äº‹ä»¶
driver.execute_script("arguments[0].dispatchEvent(new Event('change', { bubbles: true }));", weibo_textarea)
```

- **åŸç†ï¼š** `change` äº‹ä»¶é€šå¸¸åœ¨è¡¨å•å…ƒç´ çš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œå¹¶ä¸”å¤±å»ç„¦ç‚¹æ—¶è§¦å‘ã€‚

#### æ–¹æ¡ˆ 3ï¼šè§¦å‘ `keyup` äº‹ä»¶ï¼ˆæ¨¡æ‹Ÿé”®ç›˜æŒ‰é”®ï¼‰

```javascript
// ä½¿ç”¨ JavaScript è®¾ç½®æ–‡æœ¬æ¡†çš„å€¼
driver.execute_script("arguments[0].value = arguments[1];", weibo_textarea, writer)

// è§¦å‘ keyup äº‹ä»¶ (æ¨¡æ‹ŸæŒ‰ä¸‹ç©ºæ ¼é”®)
driver.execute_script("arguments[0].dispatchEvent(new KeyboardEvent('keyup', { bubbles: true, key: ' ', code: 'Space' }));", weibo_textarea)
```

- **åŸç†ï¼š** `keyup` äº‹ä»¶åœ¨é”®ç›˜æŒ‰é”®è¢«é‡Šæ”¾æ—¶è§¦å‘ã€‚è¿™é‡Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªç©ºæ ¼é”®çš„ `keyup` äº‹ä»¶ã€‚

#### æ–¹æ¡ˆ 4ï¼šç»„åˆè§¦å‘å¤šä¸ªäº‹ä»¶

```javascript
// ä½¿ç”¨ JavaScript è®¾ç½®æ–‡æœ¬æ¡†çš„å€¼
driver.execute_script("arguments[0].value = arguments[1];", weibo_textarea, writer)

// ä¾æ¬¡è§¦å‘ input å’Œ change äº‹ä»¶
driver.execute_script("arguments[0].dispatchEvent(new Event('input', { bubbles: true }));", weibo_textarea)
driver.execute_script("arguments[0].dispatchEvent(new Event('change', { bubbles: true }));", weibo_textarea)
```

- **åŸç†ï¼š**  ç»“åˆå¤šç§äº‹ä»¶çš„è§¦å‘ï¼Œæ›´å…¨é¢åœ°æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥ã€‚

ç»æµ‹è¯•ï¼Œ**æ–¹æ¡ˆ 1ï¼šè§¦å‘ `input` äº‹ä»¶** æˆåŠŸè§£å†³äº†é—®é¢˜ï¼è¿™è¡¨æ˜ï¼Œå¾®åšçš„å‘é€æŒ‰é’®æ¿€æ´»é€»è¾‘å¾ˆå¯èƒ½ç›‘å¬äº† `input` äº‹ä»¶ã€‚

## é—®é¢˜ä¸‰ï¼šéšå¼ç­‰å¾…å¯¼è‡´çš„é—®é¢˜

åœ¨æœ€åˆçš„ `ghost_writer` å‡½æ•°ä¸­ï¼Œç‚¹å‡»å‘é€æŒ‰é’®åï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š

```python
submit_button.click()
time.sleep(2)
print("å¾®åšå‘å¸ƒæˆåŠŸ")
```

è¿™æ®µä»£ç çš„æœ¬æ„æ˜¯ç­‰å¾…å¾®åšå‘å¸ƒå®Œæˆã€‚ç„¶è€Œï¼Œ`time.sleep(2)` æ˜¯ä¸€ç§**éšå¼ç­‰å¾…**ï¼Œå®ƒä¼šåœ¨æŒ‡å®šçš„æ—¶é—´å†…ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ, æˆ–è€…ç­‰å¾…æŸä¸ªå…ƒç´ çš„å‡ºç°ã€‚ä½†æ˜¯, å³ä½¿ç‚¹å‡»å‘é€æŒ‰é’®å¤±è´¥ï¼ˆä¾‹å¦‚æŒ‰é’®æ˜¯ç°è‰²çš„ï¼‰ï¼Œè¿™æ®µä»£ç ä»ç„¶ä¼šç­‰å¾… 2 ç§’é’Ÿï¼Œç„¶åæ‰§è¡Œ `print("å¾®åšå‘å¸ƒæˆåŠŸ")`ã€‚è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼š**å³ä½¿å¾®åšæ²¡æœ‰å‘å¸ƒæˆåŠŸï¼Œè„šæœ¬ä¹Ÿä¼šé”™è¯¯åœ°è¾“å‡ºâ€œå¾®åšå‘å¸ƒæˆåŠŸâ€ã€‚**

### è§£å†³æ–¹æ¡ˆ

å°† `time.sleep(2)` åˆ é™¤ï¼Œå¹¶ä½¿ç”¨ `try...except` è¯­å¥æ¥æ•è· `submit_button.click()` å¯èƒ½å‡ºç°çš„å¼‚å¸¸ã€‚

```python
try:
    # æäº¤å¾®åš
    # ç­‰å¾…æäº¤æŒ‰é’®å¯è§
    submit_button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, 'div.m-box.m-flex-grow1.m-box-model.m-fd-row.m-aln-center.m-justify-end.m-flex-base0 > a')))
    # CSS å’Œ Xpath ç»“åˆå®šä½
    # submit_button = wait.until(EC.element_to_be_clickable((By.XPATH, '//*[@id="app"]//a[contains(@class, "m-box")]'))) 

    submit_button.click()
    print("å¾®åšå‘å¸ƒæˆåŠŸ")
except Exception as e:
    print(f"å¾®åšå‘å¸ƒå¤±è´¥: {e}")
```

**åŸç†ï¼š**

*   `try...except` è¯­å¥ç”¨äºæ•è·ä»£ç å—ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸ã€‚
*   å¦‚æœ `submit_button.click()` æ‰§è¡ŒæˆåŠŸï¼Œåˆ™ä¼šè¾“å‡ºâ€œå¾®åšå‘å¸ƒæˆåŠŸâ€ã€‚
*   å¦‚æœ `submit_button.click()` æ‰§è¡Œå¤±è´¥ï¼ˆä¾‹å¦‚æŒ‰é’®ä¸å¯ç‚¹å‡»ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ`except` è¯­å¥å—ä¼šæ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶è¾“å‡ºâ€œå¾®åšå‘å¸ƒå¤±è´¥: â€ä»¥åŠå…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚

> **ä¸ºä»€ä¹ˆ `submit_button.click()` ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Ÿ**
> å½“æˆ‘ä»¬ä½¿ç”¨ `wait.until(EC.element_to_be_clickable(...))` æ—¶ï¼ŒSelenium ä¼šç­‰å¾…å…ƒç´ å˜ä¸ºå¯ç‚¹å‡»çŠ¶æ€ã€‚ä½†æ˜¯ï¼Œåœ¨é—®é¢˜äºŒä¸­ï¼Œå³ä½¿å‘é€æŒ‰é’®æ˜¯ç°è‰²çš„ï¼Œ`wait.until` ä¾ç„¶ä¼šè®¤ä¸ºå…ƒç´ æ˜¯å¯ç‚¹å‡»çš„ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ ã€‚è€Œå½“æˆ‘ä»¬å°è¯•ç‚¹å‡»è¿™ä¸ªå®é™…ä¸Šä¸å¯ç‚¹å‡»çš„å…ƒç´ æ—¶ï¼ŒSelenium å°±ä¼šæŠ›å‡ºå¼‚å¸¸, é€šå¸¸æ˜¯ `ElementClickInterceptedException` æˆ–è€… `ElementNotInteractableException`.

è¿™æ ·ä¿®æ”¹ä¹‹åï¼Œè„šæœ¬å°±èƒ½æ›´å‡†ç¡®åœ°åˆ¤æ–­å¾®åšæ˜¯å¦å‘å¸ƒæˆåŠŸï¼Œå¹¶ç»™å‡ºç›¸åº”çš„æç¤ºã€‚åŒæ—¶ä¹Ÿå»æ‰äº†å›ºå®šçš„å»¶æ—¶, åŠ é€Ÿäº†å‘å¸ƒã€‚

## æ€»ç»“

é€šè¿‡è¿™æ¬¡ Debugï¼Œå¯ä»¥æ·±å…¥äº†è§£åˆ°ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

-   **msedgedriver å¯¹ Unicode å­—ç¬¦çš„é™åˆ¶ï¼š** äº†è§£äº† BMP å’Œ SMP çš„æ¦‚å¿µï¼Œä»¥åŠ msedgedriver å¯¹é BMP å­—ç¬¦çš„å¤„ç†æ–¹å¼ã€‚
-   **JavaScript äº‹ä»¶çš„é‡è¦æ€§ï¼š**  è®¤è¯†åˆ° JavaScript äº‹ä»¶åœ¨ç½‘é¡µäº¤äº’ä¸­çš„é‡è¦ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ `dispatchEvent` æ‰‹åŠ¨è§¦å‘äº‹ä»¶ã€‚
-   **Selenium çš„å·¥ä½œåŸç†ï¼š**  å¯¹ Selenium çš„ `send_keys`ã€`execute_script`ã€`wait.until` ç­‰æ–¹æ³•æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ã€‚
-   **éšå¼ç­‰å¾…çš„å¼Šç«¯ï¼š**  è®¤è¯†åˆ°éšå¼ç­‰å¾…å¯èƒ½å¯¼è‡´çš„é—®é¢˜ï¼Œéœ€è¦å­¦ä¼šä½¿ç”¨ `try...except` æ¥è¿›è¡Œæ›´ç²¾ç»†çš„é”™è¯¯å¤„ç†ã€‚

## è„šæœ¬åœ°å€ï¼š

[GhostwriterWeibo_v2.py](https://github.com/kay-a11y/Gazer/blob/main/WeiboGaze/src/GhostwriterWeibo_v2.py)
